```markdown
# üì¶ E-commerce Data Pipeline (Airflow + DuckDB + PostgreSQL)

![Architecture Diagram](images/Pic_Ecommerce.png)

## üéØ –ó–∞–¥–∞—á–∞ –ø—Ä–æ–µ–∫—Ç–∞
–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞–¥—ë–∂–Ω—ã–π end-to-end data pipeline –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ e-commerce –¥–∞–Ω–Ω—ã—Ö.

### –ü—Ä–æ–µ–∫—Ç —Ä–µ—à–∞–µ—Ç:
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Data Lake
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–ª–æ—è (ODS)
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω (Data Mart)
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞:
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–æ–≤
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
External API (DummyJSON)
        ‚Üì
RAW layer (MinIO / S3, Parquet)
        ‚Üì
ODS layer (PostgreSQL)
        ‚Üì
Data Mart (PostgreSQL)
```

## –°–ª–æ–∏ –¥–∞–Ω–Ω—ã—Ö

### RAW
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: DummyJSON API
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: MinIO (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ)
- **–§–æ—Ä–º–∞—Ç**: Parquet
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### ODS (Operational Data Store)
- **–°—Ö–µ–º–∞**: `ods`
- **–¢–∞–±–ª–∏—Ü–∞**: `fct_products`
- **–ó–∞–≥—Ä—É–∑–∫–∞**: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è (upsert)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### Data Mart (DM)
- **–°—Ö–µ–º–∞**: `dm`
- **–¢–∞–±–ª–∏—Ü–∞**: `fct_products_stats`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –¥–ª—è BI

## üß© –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Apache Airflow** ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- **DuckDB** ‚Äî ETL-–¥–≤–∏–∂–æ–∫
- **PostgreSQL** ‚Äî ODS –∏ Data Mart
- **MinIO** ‚Äî S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **Docker Compose** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
dags/
‚îú‚îÄ‚îÄ raw_s3_api.py              # RAW ‚Üí S3
‚îú‚îÄ‚îÄ ecommerce_ods_pg.py        # S3 ‚Üí ODS
‚îî‚îÄ‚îÄ FCT_dm_ecommerce.py        # ODS ‚Üí DM
```

## üîÅ –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (DAG'–∏)

### `raw_s3_api`
- **–ó–∞–¥–∞—á–∞**: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API –≤ S3
- **–§–æ—Ä–º–∞—Ç**: Parquet
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: Daily snapshots

### `ecommerce_ods_pg`
- **–ó–∞–¥–∞—á–∞**: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ S3 –≤ PostgreSQL ODS
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `ON CONFLICT`
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: `raw_s3_api`

### `FCT_dm_ecommerce`
- **–ó–∞–¥–∞—á–∞**: –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –≤–∏—Ç—Ä–∏–Ω—ã
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: `ecommerce_ods_pg`

## üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –≤–∏—Ç—Ä–∏–Ω–∞

**–¢–∞–±–ª–∏—Ü–∞:** `dm.fct_products_stats`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤–∏—Ç—Ä–∏–Ω—ã:**
- –ê–Ω–∞–ª–∏–∑ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞—Ç–∫–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ü–µ–Ω –∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å BI-—Å–∏—Å—Ç–µ–º–∞–º–∏

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```bash
docker-compose up -d
```
### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ MinIO
1. –û—Ç–∫—Ä–æ–π—Ç–µ MinIO UI: http://localhost:9000
2. –°–æ–∑–¥–∞–π—Ç–µ bucket:
   - –ù–∞–∂–º–∏—Ç–µ **Create Bucket**
   - –í–≤–µ–¥–∏—Ç–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: `supfun`)
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ
3. –°–æ–∑–¥–∞–π—Ç–µ Access Keys:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Access Keys** ‚Üí **Create access key**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `Access Key` –∏ `Secret Key`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Airflow Variables
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Airflow UI: http://localhost:8080

**Admin ‚Üí Variables ‚Üí +**:

| Key | Value | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|-------|----------|
| `access_key` | `–≤–∞—à_access_key` | MinIO Access Key |
| `secret_key` | `–≤–∞—à_secret_key` | MinIO Secret Key |
| `pg_password` | `postgres` | –ü–∞—Ä–æ–ª—å PostgreSQL |

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Airflow Connections
**Admin ‚Üí Connections ‚Üí +**:

**PostgreSQL Connection:**
- **Connection ID**: `postgres_dwh`
- **Connection Type**: `Postgres`
- **Host**: `postgres_dwh`
- **Database**: `postgres`
- **Login**: `postgres`
- **Password**: `postgres`
- **Port**: `5432`
- **Schema**: `postgres`

–ù–∞–∂–º–∏—Ç–µ **Save**.

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: `.env` —Ñ–∞–π–ª (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```bash
# MinIO
MINIO_ACCESS_KEY=–≤–∞—à_access_key
MINIO_SECRET_KEY=–≤–∞—à_secret_key

# PostgreSQL
POSTGRES_PASSWORD=postgres

# Airflow
AIRFLOW_UID=1000
```

### 5. –ê–∫—Ç–∏–≤–∞—Ü–∏—è DAG'–æ–≤
1. –í–∫–ª—é—á–∏—Ç—å DAG'–∏ –≤ Airflow UI
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ –ø–æ—Ä—è–¥–∫–µ:
   - `raw_s3_api`
   - `ecommerce_ods_pg`
   - `FCT_dm_ecommerce`

## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤**: RAW / ODS / DM
2. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º—ã
3. **–õ–æ–≥–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ds` –≤–º–µ—Å—Ç–æ `CURRENT_DATE`
4. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ß—ë—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ `ExternalTaskSensor`
5. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏**: –í RAW —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

## üõ†Ô∏è –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚úÖ End-to-end –ø–∞–π–ø–ª–∞–π–Ω –æ—Ç API –¥–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π Data Lake (MinIO)
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (Airflow)
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å BI


```
![alt text](image.png)